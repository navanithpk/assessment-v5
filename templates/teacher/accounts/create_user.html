{% extends "teacher/teacher_base.html" %}

{% block title %}Create User Account{% endblock %}

{% block content %}
<style>
.form-container {
  max-width: 600px;
  margin: 0 auto;
  background: white;
  border-radius: 16px;
  padding: 32px;
  box-shadow: 0 4px 12px rgba(0,0,0,.08);
}

.form-header {
  margin-bottom: 24px;
}

.form-header h1 {
  font-size: 28px;
  font-weight: 700;
  color: #111827;
  margin: 0 0 8px 0;
}

.form-header p {
  color: #6b7280;
  margin: 0;
}

.school-badge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: #dbeafe;
  color: #1e40af;
  padding: 8px 16px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  margin-top: 12px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  font-weight: 600;
  margin-bottom: 8px;
  color: #374151;
}

.form-group input,
.form-group select {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  font-size: 14px;
}

.form-group small {
  display: block;
  color: #6b7280;
  margin-top: 4px;
  font-size: 13px;
}

.role-selection {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-top: 8px;
}

.role-option {
  border: 2px solid #e5e7eb;
  border-radius: 10px;
  padding: 16px;
  cursor: pointer;
  transition: all .2s;
  position: relative;
}

.role-option:hover:not(.disabled) {
  border-color: #2563eb;
  background: #f0f9ff;
}

.role-option input[type="radio"] {
  position: absolute;
  opacity: 0;
}

.role-option.selected {
  border-color: #2563eb;
  background: #dbeafe;
}

.role-option.disabled {
  opacity: 0.5;
  cursor: not-allowed;
  background: #f9fafb;
}

.role-label {
  font-weight: 600;
  color: #111827;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 15px;
}

.role-desc {
  font-size: 13px;
  color: #6b7280;
  margin-top: 6px;
}

.warning-box {
  background: #fef3c7;
  border: 1px solid #fbbf24;
  border-radius: 8px;
  padding: 12px 16px;
  margin-bottom: 20px;
  display: flex;
  align-items: start;
  gap: 12px;
}

.warning-icon {
  font-size: 20px;
}

.warning-text {
  flex: 1;
  font-size: 14px;
  color: #78350f;
}

.info-box {
  background: #dbeafe;
  border: 1px solid #3b82f6;
  border-radius: 8px;
  padding: 12px 16px;
  margin-bottom: 20px;
  display: flex;
  align-items: start;
  gap: 12px;
}

.info-icon {
  font-size: 20px;
}

.info-text {
  flex: 1;
  font-size: 14px;
  color: #1e40af;
}

.btn-group {
  display: flex;
  gap: 12px;
  margin-top: 24px;
}

.btn {
  padding: 10px 18px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  transition: all .2s;
  flex: 1;
}

.btn.primary {
  background: #2563eb;
  color: white;
}

.btn.primary:hover {
  background: #1d4ed8;
}

.btn.secondary {
  background: #f3f4f6;
  color: #374151;
}

.btn.secondary:hover {
  background: #e5e7eb;
}

.messages {
  margin-bottom: 20px;
}

.alert {
  padding: 12px 16px;
  border-radius: 8px;
  margin-bottom: 12px;
}

.alert.error {
  background: #fee2e2;
  color: #991b1b;
  border: 1px solid #fecaca;
}

.alert.success {
  background: #d1fae5;
  color: #065f46;
  border: 1px solid #a7f3d0;
}
</style>

<div class="form-container">
  <div class="form-header">
    <h1>üë§ Create User Account</h1>
    <p>Create a new user account for the system</p>
    
    {% if school %}
      <div class="school-badge">
        üè´ {{ school.name }}
      </div>
    {% endif %}
  </div>

  {% if messages %}
  <div class="messages">
    {% for message in messages %}
      <div class="alert {{ message.tags }}">
        {{ message }}
      </div>
    {% endfor %}
  </div>
  {% endif %}

  {% if is_school_admin %}
  <div class="info-box">
    <span class="info-icon">‚ÑπÔ∏è</span>
    <div class="info-text">
      <strong>School Admin Privileges:</strong> You can create both student and teacher accounts.
    </div>
  </div>
  {% else %}
  <div class="warning-box">
    <span class="warning-icon">‚ö†Ô∏è</span>
    <div class="warning-text">
      <strong>Note:</strong> As a teacher, you can only create student accounts. 
      Contact a school admin to create teacher accounts.
    </div>
  </div>
  {% endif %}

  <form method="post">
    {% csrf_token %}

    <div class="form-group">
      <label>Account Type *</label>
      <div class="role-selection">
        <label class="role-option selected" id="studentRole">
          <input type="radio" name="role" value="student" checked required>
          <div>
            <div class="role-label">
              üë®‚Äçüéì Student
            </div>
            <div class="role-desc">Regular student account with test access</div>
          </div>
        </label>

        <label class="role-option {% if not is_school_admin %}disabled{% endif %}" id="teacherRole">
          <input 
            type="radio" 
            name="role" 
            value="teacher" 
            {% if not is_school_admin %}disabled{% endif %}
            required
          >
          <div>
            <div class="role-label">
              üë®‚Äçüè´ Teacher
            </div>
            <div class="role-desc">
              {% if is_school_admin %}
                Teacher with full teaching privileges
              {% else %}
                School admin only
              {% endif %}
            </div>
          </div>
        </label>
      </div>
    </div>

    <div class="form-group">
      <label>Username * </label>
      <input 
        type="text" 
        name="username" 
        required 
        placeholder="e.g., john.doe or student123"
        pattern="[a-zA-Z0-9_.@]+"
      >
      <small>Letters, numbers, @ . _ only. Can be email address.</small>
    </div>

    <div class="form-group">
      <label>Password *</label>
      <input 
        type="password" 
        name="password" 
        required 
        minlength="6"
        placeholder="Minimum 6 characters"
      >
    </div>

    <div class="form-group">
      <label>Email</label>
      <input type="email" name="email" placeholder="user@example.com">
    </div>

    <div class="form-group">
      <label>First Name</label>
      <input type="text" name="first_name" placeholder="John">
    </div>

    <div class="form-group">
      <label>Last Name</label>
      <input type="text" name="last_name" placeholder="Doe">
    </div>

    <div class="btn-group">
      <a href="{% url 'teacher_dashboard' %}" class="btn secondary">
        Cancel
      </a>
      <button type="submit" class="btn primary">
        ‚úÖ Create Account
      </button>
    </div>
  </form>
</div>

<script>
// Handle role selection visual feedback
const studentRole = document.getElementById('studentRole');
const teacherRole = document.getElementById('teacherRole');

function updateRoleSelection() {
  const studentRadio = studentRole.querySelector('input[type="radio"]');
  const teacherRadio = teacherRole.querySelector('input[type="radio"]');
  
  if (studentRadio.checked) {
    studentRole.classList.add('selected');
    teacherRole.classList.remove('selected');
  } else if (teacherRadio && teacherRadio.checked && !teacherRadio.disabled) {
    teacherRole.classList.add('selected');
    studentRole.classList.remove('selected');
  }
}

// Listen for changes
document.querySelectorAll('input[name="role"]').forEach(radio => {
  radio.addEventListener('change', updateRoleSelection);
});

// Make the whole label clickable
studentRole.addEventListener('click', () => {
  const radio = studentRole.querySelector('input[type="radio"]');
  radio.checked = true;
  updateRoleSelection();
});

teacherRole.addEventListener('click', (e) => {
  const teacherRadio = teacherRole.querySelector('input[type="radio"]');
  
  if (teacherRadio.disabled) {
    e.preventDefault();
    alert('Only school administrators can create teacher accounts. Please contact your school admin.');
  } else {
    teacherRadio.checked = true;
    updateRoleSelection();
  }
});
</script>

{% endblock %}